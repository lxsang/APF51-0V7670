########################################
#  This file was generated by hdlmake  #
#  http://ohwr.org/projects/hdl-make/  #
########################################

PROJECT := obtr_prj.xise
ISE_CRAP := *.b top_level_summary.html *.tcl top_level.bld top_level.cmd_log *.drc top_level.lso *.ncd top_level.ngc top_level.ngd top_level.ngr top_level.pad top_level.par top_level.pcf top_level.prj top_level.ptwx top_level.stx top_level.syr top_level.twr top_level.twx top_level.gise top_level.unroutes top_level.ut top_level.xpi top_level.xst top_level_bitgen.xwbt top_level_envsettings.html top_level_guide.ncd top_level_map.map top_level_map.mrp top_level_map.ncd top_level_map.ngm top_level_map.xrpt top_level_ngdbuild.xrpt top_level_pad.csv top_level_pad.txt top_level_par.xrpt top_level_summary.xml top_level_usage.xml top_level_xst.xrpt usage_statistics_webtalk.html webtalk.log webtalk_pn.xml run.tcl

#target for performing local synthesis
local:
		echo "project open $(PROJECT)" > run.tcl
		echo "process run {Generate Programming File} -force rerun_all" >> run.tcl
		xtclsh run.tcl


#target for cleaing all intermediate stuff
clean:
		rm -f $(ISE_CRAP)
		rm -rf xst xlnx_auto_*_xdb iseconfig _xmsgs _ngo
    
#target for cleaning final files
mrproper:
		rm -f *.bit *.bin *.mcs

USER:=$(HDLMAKE_USER)#take the value from the environment
SERVER:=$(HDLMAKE_SERVER)#take the value from the environment
R_NAME:=obtr_prj

__test_for_remote_synthesis_variables:
ifeq (x$(USER),x)
	@echo "Remote synthesis user is not set. You can set it by editing variable USER in the makefile." && false
endif
ifeq (x$(SERVER),x)
	@echo "Remote synthesis server is not set. You can set it by editing variable SERVER in the makefile." && false
endif

CWD := $(shell pwd)

FILES := top_level.ucf \
../top_level.vhd \
../../ov7670_interface/clock_gen.vhd \
../../wb_irq/debounce.vhd \
../interface_mngr.vhd \
../hsvfilter.vhd \
../mult9x9.vhd \
../filter_unit.vhd \
../flag_sync.vhd \
../center_of_mass.vhd \
../processing_unit.vhd \
../camera_unit_v1.vhd \
../object_position_unit.vhd \
../../ov7670_interface/dual_port_dual_clock.vhd \
../../wb_irq/rstgen_syscon.vhd \
../irq_mngr.vhd \
../../wb_irq/imx51_wb16_wrapper.vhd \
../ov7670_capture.vhd \
../../ov7670_interface/ov7670_controller.vhd \
../../ov7670_interface/ov7670_registers.vhd \
../../ov7670_interface/i2c_sender.vhd \
run.tcl \
obtr_prj.xise

#target for running simulation in the remote location
remote: __test_for_remote_synthesis_variables __send __do_synthesis __send_back
__send_back: __do_synthesis
__do_synthesis: __send
__send: __test_for_remote_synthesis_variables

__send:
		ssh $(USER)@$(SERVER) 'mkdir -p $(R_NAME)'
		rsync -Rav $(foreach file, $(FILES), $(shell readlink -f $(file))) $(USER)@$(SERVER):$(R_NAME)

__do_synthesis:
		ssh $(USER)@$(SERVER) 'cd $(R_NAME)$(CWD) && xtclsh run.tcl'

__send_back: 
		cd .. && rsync -av $(USER)@$(SERVER):$(R_NAME)$(CWD) . && cd $(CWD)

#target for removing stuff from the remote location
cleanremote:
		ssh $(USER)@$(SERVER) 'rm -rf $(R_NAME)'

